# 静态资源处理与路径别名

在 Vite 项目中，静态资源处理和路径别名配置是提升开发体验的重要功能。本文档介绍了如何在 Vite 中处理图片、JSON 等静态资源，以及如何配置路径别名。

## 静态资源处理

### 图片资源导入

Vite 支持多种方式导入图片资源：

#### 1. 默认导入（URL 模式）

```javascript
// imageLoader.js
import pic from './assets/images/1.png' // 后缀不能省略
console.log('pic', pic) // 拿到绝对路径

// 等同于显式指定 url 参数
// import pic from './assets/images/1.png?url'
```

**特点：**
- 返回图片的绝对路径
- Vite 会自动处理图片优化和缓存
- 适用于在 JavaScript 中动态使用图片

#### 2. Raw 模式导入

```javascript
// 获取原始数据 Buffer 二进制字符串
// import pic from './assets/images/1.png?raw'
```

**用途：**
- 获取图片的二进制数据
- 适用于需要对图片进行特殊处理的场景

#### 3. 在 DOM 中使用图片

```javascript
const image = document.createElement('img')
image.src = pic
document.body.appendChild(image)
```

### JSON 文件处理

Vite 对 JSON 文件有特殊的处理机制：

#### 1. 默认导出

```javascript
// main.js
import jsonFile from './src/assets/json/index.json'

// 导出一个对象
// 如果没有使用 vite 其他构建工具中则会导出一个字符串
console.log('jsonFile', jsonFile)
```

**在 Vite 中：**
- JSON 文件被解析为 JavaScript 对象
- 支持热更新

**在其他构建工具中：**
- 可能导出字符串，需要手动 `JSON.parse()`

#### 2. 具名导出（树摇优化）

```javascript
// 具名导出 利于树摇
import { name } from './src/assets/json/index.json'
console.log('name', name)
```

**JSON 文件内容：**
```json
{
    "name": "jinx"
}
```

**优势：**
- 支持 Tree Shaking，只打包使用的字段
- 减少最终包体积

## 路径别名配置

### 配置路径别名

在 `vite.base.config.js` 中配置路径别名：

```javascript
import { defineConfig } from "vite";
import path from 'node:path'
import { fileURLToPath } from 'node:url'

// ES Module 中获取 __dirname
const __dirname = path.dirname(fileURLToPath(import.meta.url))

export default defineConfig({
    resolve: {
        alias: {
            "@": path.resolve(__dirname, './src'),
            "@assets": path.resolve(__dirname, './src/assets')
        }
    }
})
```

### 路径别名的使用

#### 1. 图片资源

```javascript
// 使用别名导入图片
import pic2 from '@assets/images/1.png'
console.log('pic2', pic2) // 拿到绝对路径
```

#### 2. 组件和模块

```javascript
// 原始路径
import Component from '../../../components/Component.vue'

// 使用别名
import Component from '@/components/Component.vue'
```

#### 3. 样式文件

```css
/* 在 CSS 中使用别名 */
.container {
    background-image: url('@assets/images/background.png');
}
```

## 项目结构

### 当前项目的资源组织

```
test-vite/
├── src/
│   ├── assets/
│   │   ├── images/
│   │   │   └── 1.png          # 示例图片
│   │   └── json/
│   │       └── index.json     # JSON 数据文件
│   └── imageLoader.js         # 图片加载器
├── main.js                    # 主入口文件
└── vite.base.config.js       # Vite 配置文件
```

### 资源引用关系

```
main.js
├── 导入 imageLoader.js
├── 导入 index.json (默认导出)
└── 导入 index.json (具名导出)

imageLoader.js
├── 导入 1.png (相对路径)
├── 导入 1.png (别名路径)
└── 创建 img 元素显示图片
```

## ES Module 中的路径处理

### __dirname 的替代方案

在 ES Module 环境中，`__dirname` 不可用，需要使用以下方式：

```javascript
import path from 'node:path'
import { fileURLToPath } from 'node:url'

// 获取当前文件的目录路径
const __dirname = path.dirname(fileURLToPath(import.meta.url))
```

**说明：**
- `import.meta.url`：获取当前模块的 URL
- `fileURLToPath()`：将 file:// URL 转换为文件路径
- `path.dirname()`：获取文件的目录路径

### 配置注意事项

```javascript
// ❌ CommonJS 语法（在 ES Module 中不可用）
const __dirname = __dirname

// ✅ ES Module 语法
const __dirname = path.dirname(fileURLToPath(import.meta.url))
```

## 最佳实践

### 1. 路径别名命名规范

```javascript
resolve: {
    alias: {
        "@": path.resolve(__dirname, './src'),           // 根目录别名
        "@components": path.resolve(__dirname, './src/components'),
        "@assets": path.resolve(__dirname, './src/assets'),
        "@utils": path.resolve(__dirname, './src/utils'),
        "@styles": path.resolve(__dirname, './src/styles')
    }
}
```

### 2. 静态资源组织

```
src/
├── assets/
│   ├── images/          # 图片资源
│   ├── fonts/           # 字体文件
│   ├── json/            # JSON 数据
│   └── videos/          # 视频文件
├── components/          # 组件
└── styles/             # 样式文件
```

### 3. 导入规范

```javascript
// 优先使用别名
import logo from '@assets/images/logo.png'
import config from '@assets/json/config.json'

// 组件导入
import Header from '@components/Header.vue'
import { formatDate } from '@utils/date.js'
```

## 性能优化

### 1. Tree Shaking

```javascript
// ❌ 导入整个 JSON 对象
import config from '@assets/json/config.json'
const apiUrl = config.apiUrl

// ✅ 只导入需要的字段
import { apiUrl } from '@assets/json/config.json'
```

### 2. 图片优化

```javascript
// 小图片会被转换为 base64
import smallIcon from '@assets/images/small-icon.png'

// 大图片保持文件引用
import largeImage from '@assets/images/hero-banner.jpg'
```

## 总结

静态资源处理和路径别名是现代前端开发的重要特性：

1. **静态资源处理**：Vite 提供了灵活的资源导入方式
2. **路径别名**：简化长路径引用，提升开发体验
3. **ES Module 兼容**：正确处理模块环境差异
4. **性能优化**：合理使用 Tree Shaking 和资源优化
5. **项目组织**：建立清晰的资源组织结构

这些功能大大提升了开发效率和项目的可维护性。