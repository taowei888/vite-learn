# 【构建优化篇】gzip压缩

## 背景
当文件资源过大时（如 JS 文件达到 2000kb），会显著影响 HTTP 传输效率。通过对静态文件进行 gzip 压缩，可以有效减少文件体积，提升传输性能。

## 工作原理
```
服务端 → 压缩文件 → 客户端接收压缩包 → 浏览器解压缩
```

## 关键概念
**Chunk（块）**：从入口文件及其一系列依赖最终打包生成的 JS 文件称为块。块会映射成 JS 文件，但块本身不是 JS 文件。

## 实现方式

### 1. 使用 vite-plugin-compression 插件
```bash
npm install vite-plugin-compression -D
```

### 2. 配置 Vite
```js
import viteCompression from 'vite-plugin-compression';

export default defineConfig({
  plugins: [
    viteCompression()
  ]
});
```

### 3. 服务端配置
- 当客户端请求 `index.js` 时，服务端读取 `index.js.gz` 文件
- 设置响应头：`Content-Encoding: gzip`
- 告知浏览器该文件使用 gzip 压缩

### 4. 浏览器处理
- 浏览器收到响应，检测到 `Content-Encoding: gzip` 响应头
- 自动解压缩获得原始 JS 文件
- **注意**：浏览器需要承担一定的解压缩时间

## 使用建议
- **适用场景**：文件体积较大的情况
- **不建议使用**：体积不大的文件，解压缩开销可能得不偿失
- **部署方式**：将压缩后的 `.gz` 文件交给后端或运维团队进行服务器配置