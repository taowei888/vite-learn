# vite 配置文件处理细节

## 1. vite配置文件的语法提示

### 方法一：使用 defineConfig
```javascript
import { defineConfig } from "vite";
export default defineConfig({
    optimizeDeps: {
        exclude: [],
    }
})
```

### 方法二：使用类型注释（不使用import时）
```javascript
/* @type {import('vite').UserConfig} */
const viteconfig = {
    optimizeDeps: {
        exclude: [],
    }
}
```

### 重要细节：ES Module 配置
使用 `import` 语句时，需要在 `package.json` 中添加 `"type": "module"`

注意：简单的 export default {} 语法（不使用 import），不需要添加也不会报错，Vite 会特殊处理：Vite 对配置文件有特殊的加载机制，可以处理简单的 ES Module 导出
```json
{
  "type": "module"
}
```
否则 Node.js 会报错：`require() of ES Module not supported`

## 2. 环境配置处理

与 webpack 类似，vite 也支持多环境配置：
- `vite.base.config.js` - 基础配置
- `vite.dev.config.js` - 开发环境配置  
- `vite.prod.config.js` - 生产环境配置

### 策略模式实现环境配置
```javascript
import { defineConfig } from "vite";
import viteBaseConfig from './vite.base.config.js'
import viteDevConfig from './vite.dev.config.js'
import viteProdConfig from './vite.prod.config.js'

const envResolver = {
    "build": () => Object.assign({}, viteBaseConfig, viteProdConfig),
    "serve": () => ({ ...viteBaseConfig, ...viteDevConfig })
}

export default defineConfig(({ command }) => {
    // command 值根据脚本命令决定：
    // npm run dev/serve → "serve"
    // npm run build → "build"
    return envResolver[command]()
})
```

### package.json 脚本配置
```json
{
  "scripts": {
    "dev": "vite",
    "serve": "vite", 
    "build": "vite build"
  }
}
```
   